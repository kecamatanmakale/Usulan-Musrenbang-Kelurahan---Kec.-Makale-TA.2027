<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Input Usulan Musrenbang</title>
    <style>
        body { font-family: Arial; background: #f4f6f9; margin: 0; }
        .header { display: flex; align-items: center; background: #2c7be5; color: white; padding: 12px 20px; }
        .logo { width: 45px; margin-right: 15px; }
        .container { padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
        input, select, textarea, button { width: 100%; padding: 10px; margin-top: 10px; box-sizing: border-box; }
        button { background: #2c7be5; color: white; border: none; cursor: pointer; font-weight: bold; }
        button.secondary { background: #6c757d; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background: #f8f9fa; }
        .btn-export { background: #28a745; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="header">
        <img src="Logo_Tana_Toraja.png" class="logo">
        <strong id="labelKelurahan">Input Usulan</strong>
    </div>

    <div class="container">
        <div class="card">
            <h4>Form Tambah Usulan</h4>
            <select id="bidang">
                <option value="">-- Pilih Bidang --</option>
                <option>Sarana dan Prasarana</option>
                <option>Sosial Budaya</option>
                <option>Ekonomi</option>
            </select>
            <input id="kegiatan" placeholder="Nama Kegiatan">
            <input id="lokasi" placeholder="Lokasi Spesifik">
            <input id="volume" placeholder="Volume (Contoh: 100 Meter)">
            <input id="anggaran" type="number" placeholder="Estimasi Anggaran (Rp)">
            <textarea id="keterangan" placeholder="Keterangan tambahan..."></textarea>
            <button onclick="simpan()">Kirim Usulan ke Cloud</button>
            <button class="secondary" onclick="location.href='dashboard.html'">Kembali ke Dashboard</button>
        </div>

        <div class="card" style="overflow-x:auto;">
            <h4>Data Usulan Lokal (Hanya Sesi Ini)</h4>
            <button class="btn-export" onclick="exportExcel()">Export Excel (.xls)</button>
            <table id="tabelData">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Bidang</th>
                        <th>Kegiatan</th>
                        <th>Lokasi</th>
                        <th>Anggaran</th>
                    </tr>
                </thead>
                <tbody id="tbody"></tbody>
            </table>
        </div>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbx5GcGHWBBuUvZ9zWzyzMl3PjvhQXvTrAPnLpbCHvhVCAR0Jc_w3ENIec589FJIpTdc/exec"; // GANTI DENGAN URL APPS SCRIPT ANDA
        const kelurahan = localStorage.getItem("kelurahan") || "Umum";
        document.getElementById("labelKelurahan").innerText = "Input Usulan: " + kelurahan;

        let dataLokal = [];

        async function simpan() {
            const data = {
                kelurahan: kelurahan,
                bidang: document.getElementById("bidang").value,
                kegiatan: document.getElementById("kegiatan").value,
                lokasi: document.getElementById("lokasi").value,
                volume: document.getElementById("volume").value,
                anggaran: document.getElementById("anggaran").value,
                keterangan: document.getElementById("keterangan").value
            };

            if(!data.bidang || !data.kegiatan || !data.anggaran) return alert("Mohon isi Bidang, Kegiatan, dan Anggaran!");

            // Kirim ke Google Sheets
            fetch(API_URL, {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });

            // Simpan ke tampilan tabel sementara
            dataLokal.push(data);
            tampilkan();
            alert("Data Berhasil Terkirim ke Cloud!");
            
            // Reset Form
            document.querySelectorAll("input, textarea, select").forEach(i => i.value = "");
        }

        function tampilkan() {
            const tbody = document.getElementById("tbody");
            tbody.innerHTML = "";
            dataLokal.forEach((d, i) => {
                tbody.innerHTML += `<tr>
                    <td>${i+1}</td>
                    <td>${d.bidang}</td>
                    <td>${d.kegiatan}</td>
                    <td>${d.lokasi}</td>
                    <td>${Number(d.anggaran).toLocaleString('id-ID')}</td>
                </tr>`;
            });
        }

        function exportExcel() {
            let table = document.getElementById("tabelData").outerHTML;
            let html = `<html><head><meta charset="UTF-8"></head><body><h2>Usulan ${kelurahan}</h2>${table}</body></html>`;
            let blob = new Blob([html], {type: "application/vnd.ms-excel"});
            let a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = `Usulan_${kelurahan}.xls`;
            a.click();
        }
    </script>
</body>
</html>