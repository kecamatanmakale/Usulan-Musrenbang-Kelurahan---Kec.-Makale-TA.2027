<!DOCTYPE html>
<html>
<head>
    <title>Input Usulan</title>
    <style>
        body { font-family: sans-serif; background: #f4f6f9; padding: 20px; }
        .card { background: white; padding: 25px; border-radius: 8px; max-width: 800px; margin: auto; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        input, select, textarea { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { background: #27ae60; color: white; border: none; padding: 12px; width: 100%; cursor: pointer; font-weight: bold; border-radius: 4px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 12px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
    </style>
</head>
<body>
    <div class="card">
        <button onclick="location.href='dashboard.html'" style="width:auto; background:#666;">⬅ Kembali</button>
        <h3>Input Usulan: <span id="namaKel"></span></h3>
        <form id="fUsulan">
            <input type="hidden" id="rowId">
            <select id="bidang" required>
                <option value="">-- Pilih Bidang --</option>
                <option>Bidang Sarana dan Prasarana</option><option>Bidang Sosial Budaya</option><option>Bidang Ekonomi</option>
            </select>
            <input type="text" id="kegiatan" placeholder="Nama Kegiatan" required>
            <input type="text" id="lokasi" placeholder="Lokasi Spesifik" required>
            <input type="text" id="volume" placeholder="Volume (Contoh: 200m / 1 Unit)" required>
            <input type="number" id="anggaran" placeholder="Anggaran (Rp)" required>
            <select id="opd" required>
                <option value="">-- Pilih OPD Tujuan --</option>
                <option>Diskominfo dan Persandian</option><option>DPUTR</option><option>DPRKP</option>
                <option>Dinas Kesehatan</option><option>Pendidikan dan Kebudayaan</option><option>Disparpora</option>
                <option>Dinas Sosial</option><option>Disdukcapil</option><option>Diskop UKM Perindag</option>
                <option>DLHD</option><option>DPML</option><option>DPMPTSP</option><option>Dinas Perhubungan</option>
                <option>DP3A dan KB</option><option>Dinas Perpustakaan dan Arsip Daerah</option>
                <option>Pertanian, Ketahanan Pangan dan Perikanan</option><option>Disnakertrans</option>
                <option>Bappelitbangda</option><option>BPKPD</option><option>BKPSDM</option>
                <option>Kesbangpol</option><option>BPBD</option><option>Inspektorat Daerah</option>
                <option>Satpolpp</option><option>Sekretariat Daerah</option><option>Sekretariat DPRD</option>
                <option>RSUD Lakipadada</option>
            </select>
            <textarea id="keterangan" placeholder="Keterangan tambahan"></textarea>
            <button type="submit" id="btn">KIRIM USULAN</button>
        </form>
        <hr>
        <h4>Riwayat Usulan Wilayah Anda:</h4>
        <table>
            <thead><tr><th>Kegiatan</th><th>OPD</th><th>Aksi</th></tr></thead>
            <tbody id="isiTabel"></tbody>
        </table>
    </div>
    <script>
        const API = "https://script.google.com/macros/s/AKfycbyQTPRqZaFrpsHGUrADSpnjAffkHLBDANxFzC2_Hwi4DOteviK9G77SOq5n6IU-u0CG/exec";
        const kel = localStorage.getItem("kelurahan");
        if(!kel) location.href="index.html";
        document.getElementById("namaKel").innerText = kel;

        async function load() {
            const r = await fetch(API + "?t=" + Date.now());
            const db = await r.json();
            const filtered = db.filter(x => x.kelurahan === kel);
            let h = "";
            filtered.reverse().forEach(d => {
                h += `<tr><td>${d.kegiatan}</td><td>${d.opd}</td>
                <td><button onclick="del('${d.timestamp}')" style="background:#e74c3c; padding:5px;">✖</button></td></tr>`;
            });
            document.getElementById("isiTabel").innerHTML = h;
        }

        document.getElementById("fUsulan").onsubmit = async (e) => {
            e.preventDefault();
            const data = {
                action: "insert",
                kelurahan: kel, bidang: document.getElementById("bidang").value,
                kegiatan: document.getElementById("kegiatan").value, lokasi: document.getElementById("lokasi").value,
                volume: document.getElementById("volume").value, anggaran: document.getElementById("anggaran").value,
                opd: document.getElementById("opd").value, keterangan: document.getElementById("keterangan").value
            };
            await fetch(API, { method: "POST", body: JSON.stringify(data) });
            alert("Berhasil!");
            document.getElementById("fUsulan").reset();
            load();
        };
        load();
    </script>
</body>
</html>